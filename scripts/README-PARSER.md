# External PDF Parser with GPT

ะะฐะดะตะถะฝัะน ะฟะฐััะตั ะฝะพัะผะฐัะธะฒะฝัั ะดะพะบัะผะตะฝัะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ GPT API.

## ะัะตะธะผััะตััะฒะฐ

โ **ะะฐะดะตะถะฝะพััั** - ะธัะฟะพะปัะทัะตั ะฟัะพะฒะตัะตะฝะฝัะน GPT API
โ **ะะธะฑะบะพััั** - ะผะพะถะฝะพ ะทะฐะฟััะบะฐัั ะฝะตะทะฐะฒะธัะธะผะพ ะพั ะฒะตะฑ-ัะตัะฒะตัะฐ
โ **ะัะปะฐะดะบะฐ** - ะฒะธะดะฝั ะฒัะต ะฟัะพะผะตะถััะพัะฝัะต ัะฐะณะธ
โ **ะะฐะบะตัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ** - ะผะพะถะฝะพ ะพะฑัะฐะฑะพัะฐัั ะผะฝะพะณะพ ะดะพะบัะผะตะฝัะพะฒ
โ **ะะธะปะธะฝะณะฒะฐะปัะฝะพััั** - ะฟัะธะพัะธัะตั ััััะบะพะณะพ ัะตะบััะฐ ะฒ ะดะฒััะทััะฝัั ะดะพะบัะผะตะฝัะฐั

## ะฃััะฐะฝะพะฒะบะฐ

ะัะต ะทะฐะฒะธัะธะผะพััะธ ัะถะต ัััะฐะฝะพะฒะปะตะฝั. ะฃะฑะตะดะธัะตัั, ััะพ ะตััั ัะฐะนะปั:
- `.env` - ัะพะดะตัะถะธั Supabase credentials
- `.env.local` - ัะพะดะตัะถะธั `OPENAI_API_KEY`

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### 1. ะะฐััะธะฝะณ ะพะดะฝะพะณะพ ะฝะพัะผะฐัะธะฒะฐ

```bash
node scripts/parse-pdf-with-gpt.js <norm-id>
```

ะัะธะผะตั:
```bash
node scripts/parse-pdf-with-gpt.js cm69abc123xyz
```

### 2. ะะฐััะธะฝะณ ะดะปั ะบะพะฝะบัะตัะฝะพะน ัะธััะตะผั

```bash
node scripts/parse-pdf-with-gpt.js <norm-id> <system-id>
```

ะัะธะผะตั (ัะพะปัะบะพ ััะตะฑะพะฒะฐะฝะธั ะดะปั ะะะก):
```bash
node scripts/parse-pdf-with-gpt.js cm69abc123xyz APS
```

ะะพัััะฟะฝัะต ัะธััะตะผั: `APS`, `SOUE`, `CCTV`, `ACS`, `OS`, `SCS`

### 3. ะะฐะบะตัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะฒัะตั ะฝะพัะผะฐัะธะฒะพะฒ

```bash
node scripts/parse-all-norms.js
```

ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฑัะฐะฑะพัะฐะตั ะฒัะต ะฝะพัะผะฐัะธะฒั, ั ะบะพัะพััั:
- ะััั ะฟัะธะบัะตะฟะปะตะฝะฝัะต PDF ัะฐะนะปั
- ะัะต ะฝะตั ะธะทะฒะปะตัะตะฝะฝัั ััะตะฑะพะฒะฐะฝะธะน

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

```
โโโโโโโโโโโโโโโ
โ  PDF ัะฐะนะป   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะทะฒะปะตัะตะฝะธะต ัะตะบััะฐ  โ โ pdf-parse / pdf2json
โ  (pdf-helper-combo) โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   GPT-4o-mini API   โ โ ะะฝะฐะปะธะท ะธ ััััะบัััะธัะพะฒะฐะฝะธะต
โ  (OpenAI)           โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  JSON ััะตะฑะพะฒะฐะฝะธั    โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะฐะทะฐ ะดะฐะฝะฝัั        โ โ Supabase
โ  (requirements)     โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

## ะคะพัะผะฐั ะฒััะพะดะฝัั ะดะฐะฝะฝัั

ะกะบัะธะฟั ะธะทะฒะปะตะบะฐะตั ััะตะฑะพะฒะฐะฝะธั ะฒ ัะปะตะดัััะตะผ ัะพัะผะฐัะต:

```javascript
{
  "clause": "5.2.1",           // ะัะฝะบั ะดะพะบัะผะตะฝัะฐ
  "system": "APS",              // ะกะธััะตะผะฐ
  "requirementTextShort": "...", // ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต
  "requirementTextFull": "...",  // ะะพะปะฝะพะต ััะตะฑะพะฒะฐะฝะธะต
  "checkMethod": "visual",       // ะะตัะพะด ะฟัะพะฒะตัะบะธ
  "mustCheck": false,            // ะะฑัะทะฐัะตะปัะฝะพ ะฟัะพะฒะตัััั
  "tags": ["ะฐะฒัะพะฝะพะผะฝัะน", "ะะะก"]  // ะขะตะณะธ
}
```

## ะัะฒะพะด ัะบัะธะฟัะฐ

ะกะบัะธะฟั ะฟะพะบะฐะทัะฒะฐะตั ะฟะพะดัะพะฑะฝัะน ะฟัะพะณัะตัั:

```
๐ External PDF Parser with GPT
================================

๐ Norm ID: cm69abc123xyz

๐ Step 1: Fetching norm details...
   โ Found: ะกะ ะะ 2.02-01-2023 - ะะพะถะฐัะฝะฐั ะฑะตะทะพะฟะฐัะฝะพััั ะทะดะฐะฝะธะน

๐ Step 2: Fetching PDF files...
   โ Found 1 valid file(s)

๐ Step 3: Extracting text from PDF...
   ๐ Reading: SN-RK-2.02-01-2023.pdf
   ๐ Size: 1245.67 KB
   โ Extracted 123456 characters

๐ค Step 4: Sending to GPT-4o-mini for parsing...
   ๐ Sending 123456 characters to AI
   โ Received response from GPT

๐ Step 5: Parsing AI response...
   โ Extracted 45 requirements

๐พ Step 6: Saving to database...
   โ Saved 45 requirements to database

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ PARSING COMPLETED SUCCESSFULLY!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ File: SN-RK-2.02-01-2023.pdf
๐ Text extracted: 123456 characters
๐ฏ Requirements extracted: 45
๐พ Requirements saved: 45
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะะพะปััะตะฝะธะต ID ะฝะพัะผะฐัะธะฒะฐ

### ะกะฟะพัะพะฑ 1: ะะท URL ัััะฐะฝะธัั
ะัะบัะพะนัะต ะฝะพัะผะฐัะธะฒ ะฒ ะฑัะฐัะทะตัะต:
```
http://localhost:3000/norm-library/cm69abc123xyz
                                    โโโโโโโฌโโโโโโโ
                                       norm-id
```

### ะกะฟะพัะพะฑ 2: ะะท Prisma Studio
1. ะะฐะฟัััะธัะต: `npx prisma studio`
2. ะัะบัะพะนัะต ัะฐะฑะปะธัั `norm_sources`
3. ะกะบะพะฟะธััะนัะต `id` ะฝัะถะฝะพะณะพ ะฝะพัะผะฐัะธะฒะฐ

### ะกะฟะพัะพะฑ 3: ะะท ะฑะฐะทั ะดะฐะฝะฝัั
```javascript
const { data } = await supabase
  .from('norm_sources')
  .select('id, code, title')
  .eq('code', 'ะกะ ะะ 2.02-01-2023')
  .single();
  
console.log(data.id); // cm69abc123xyz
```

## ะฃัััะฐะฝะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะธะฑะบะฐ "Norm not found"
- ะัะพะฒะตัััะต ะฟัะฐะฒะธะปัะฝะพััั `norm-id`
- ะฃะฑะตะดะธัะตัั, ััะพ ะฝะพัะผะฐัะธะฒ ัััะตััะฒัะตั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั

### ะัะธะฑะบะฐ "No PDF files attached"
- ะะฐะณััะทะธัะต PDF ัะฐะนะป ัะตัะตะท ะฒะตะฑ-ะธะฝัะตััะตะนั
- ะัะพะฒะตัััะต ัะฐะฑะปะธัั `norm_files` ะฒ Prisma Studio

### ะัะธะฑะบะฐ "Could not extract text"
- PDF ะผะพะถะตั ะฑััั ะฟะพะฒัะตะถะดะตะฝ ะธะปะธ ะทะฐัะธัะตะฝ
- ะะพะฟัะพะฑัะนัะต ะดััะณะพะน PDF ัะฐะนะป
- ะัะพะฒะตัััะต, ััะพ ัะฐะนะป ะดะตะนััะฒะธัะตะปัะฝะพ ัััะตััะฒัะตั ะฝะฐ ะดะธัะบะต

### ะัะธะฑะบะฐ "Invalid JSON response"
- GPT ะฝะต ัะผะพะณ ัะฐัะฟะฐััะธัั ะดะพะบัะผะตะฝั
- ะะพะฟัะพะฑัะนัะต ัะบะฐะทะฐัั ะบะพะฝะบัะตัะฝัั ัะธััะตะผั
- ะะพะบัะผะตะฝั ะผะพะถะตั ะฑััั ัะปะธัะบะพะผ ะฑะพะปััะธะผ (ะปะธะผะธั ~100K ัะธะผะฒะพะปะพะฒ)

## ะกัะพะธะผะพััั

GPT-4o-mini ะพัะตะฝั ะดะตัะตะฒัะน:
- Input: $0.150 / 1M tokens (~$0.00015 ะทะฐ 1000 ัะพะบะตะฝะพะฒ)
- Output: $0.600 / 1M tokens (~$0.0006 ะทะฐ 1000 ัะพะบะตะฝะพะฒ)

ะกัะตะดะฝะธะน ะดะพะบัะผะตะฝั (~50K ัะธะผะฒะพะปะพะฒ):
- Input: ~60K ัะพะบะตะฝะพะฒ = $0.009
- Output: ~5K ัะพะบะตะฝะพะฒ = $0.003
- **ะัะพะณะพ: ~$0.012 ะทะฐ ะดะพะบัะผะตะฝั** (ะฟัะธะผะตัะฝะพ 1 ัะตะฝั)

## ะกะปะตะดัััะธะต ัะฐะณะธ

ะะพัะปะต ััะฟะตัะฝะพะณะพ ะฟะฐััะธะฝะณะฐ:
1. ะัะบัะพะนัะต ะฝะพัะผะฐัะธะฒ ะฒ ะฒะตะฑ-ะธะฝัะตััะตะนัะต
2. ะัะพะฒะตัััะต ะธะทะฒะปะตัะตะฝะฝัะต ััะตะฑะพะฒะฐะฝะธั
3. ะัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ ะพััะตะดะฐะบัะธััะนัะต ะฒัััะฝัั
4. ะัะฟะพะปัะทัะนัะต ััะตะฑะพะฒะฐะฝะธั ะฒ ะฐัะดะธัะฐั

## ะะฝัะตะณัะฐัะธั ั ะฒะตะฑ-ะธะฝัะตััะตะนัะพะผ

ะ ะฑัะดััะตะผ ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะบะฝะพะฟะบั ะฒ UI, ะบะพัะพัะฐั ะฒัะทัะฒะฐะตั ััะพั ัะบัะธะฟั ัะตัะตะท API endpoint:

```typescript
// app/api/parse-pdf/route.ts
export async function POST(req: Request) {
  const { normId } = await req.json();
  
  // Run external script
  const result = await runExternalParser(normId);
  
  return Response.json(result);
}
```

ะะพ ะฟะพะบะฐ ะทะฐะฟััะบะฐะตะผ ะฒัััะฝัั ัะตัะตะท ะบะพะผะฐะฝะดะฝัั ัััะพะบั - ััะพ ะฟัะพัะต ะธ ะฝะฐะดะตะถะฝะตะต!
